{% extends "base.html" %}

{% block body %}
<div class="profile-header">
<div class="profile-avatar">
    {% if profile_user.avatar %}
      <!-- Display uploaded avatar -->
       <div class = "profile-avatar">
      <img id="profileAvatar" src="{{ profile_user.avatar.url }}" alt="{{ profile_user.username }}" 
           style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:2px solid #ccc; box-shadow:0 2px 6px rgba(0,0,0,0.2);">
    {% else %}
      <!-- Fallback to initials -->
      {{ profile_user.first_name.0|upper }}{{ profile_user.last_name.0|upper }}
    {% endif %}
    </div>
  </div>
  <h1 class="profile-name">{{ profile_user.first_name }} {{ profile_user.last_name }}</h1>
  <p class="profile-bio">@{{ profile_user.username }}</p>
  {% if profile_user.bio %}
    <p class="profile-bio">{{ profile_user.bio }}</p>
  {% endif %}
</div>

<div class="card">
  <div class="card-header">
    <h2 class="card-title">Profile Information</h2>
  </div>
  <p>Member since: {{ profile_user.date_joined|date:"M Y" }}</p>
  
  {% if request.user.is_authenticated and request.user != profile_user %}
    <div class="post-actions">
      {% if not is_friend %}
        <form method="post" action="{% url 'friend_request' profile_user.id %}" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary">Send Friend Request</button>
        </form>
      {% endif %}
      <a href="{% url 'people_posts' profile_user.id %}" class="btn btn-secondary">View Posts</a>
    </div>
  {% endif %}
</div>

<div class="card">
  <div class="card-header">
    <h2 class="card-title">Recent Posts</h2>
  </div>
  {% for post in profile_user.posts.all|slice:":5" %}
    <div class="post">
      <div class="post-header">
        <h4><a href="{% url 'view_post' post.id %}" class="post-title">{{ post.title }}</a></h4>
      </div>
      <div class="post-content">
        <p>{{ post.content|truncatewords:20 }}</p>
      </div>
      <div class="post-meta">
        {{ post.created_at|date:"M d, Y" }}
      </div>
    </div>
  {% empty %}
    <div class="text-center">
      <p>No posts yet.</p>
    </div>
  {% endfor %}
</div>
<div id = "avatarModal" class = "avatar-modal" style="display: none;" >
  <span class = "close" id = "TheX">&times;</span>
  <img  id = "ModalImg" class ="modal-content">
  <div id ="caption"></div>
</div>
<script>
  var Profileavatar = document.getElementById("profileAvatar");
  var ModalImg = document.getElementById("ModalImg");
  var caption = document.getElementById("caption");
  var avatarModal = document.getElementById("avatarModal");
  var TheX = document.getElementById("TheX");

  Profileavatar.onclick = function(){
    avatarModal.style.display = "block";
    ModalImg.src = this.src;
    caption.innerHTML = this.alt;
  }
  TheX.onclick = function(){
    avatarModal.style.display = "none";

  }
  avatarModal.onclick =function(){
    avatarModal.style.display = "none";
  }

</script>
{% endblock body %}

